<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice Leaf Disease - MLOps Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .print-page {
            width: 1200px;
            margin: 20px auto;
            background: white;
            padding: 40px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            border-radius: 15px;
        }
        @media print {
            body {
                background: white;
            }
            .print-page {
                width: 100%;
                margin: 0;
                padding: 20px;
                box-shadow: none;
                border-radius: 0;
            }
            .controls {
                display: none !important;
            }
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        .controls {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .export-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .export-btn:active {
            transform: translateY(0);
        }
        .diagram-container {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        .diagram-title {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 5px solid #667eea;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 400px;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            color: #666;
            font-size: 0.9em;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="export-btn" onclick="exportAsImage('png')">üì∏ Export as PNG</button>
        <button class="export-btn" onclick="exportAsImage('jpg')">üñºÔ∏è Export as JPG</button>
        <button class="export-btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
        <button class="export-btn" onclick="copyToClipboard()">üìã Copy Mermaid Code</button>
    </div>

    <div id="printPage" class="print-page">
        <div class="header">
            <h1>üèóÔ∏è Rice Leaf Disease Classification - MLOps System Architecture</h1>
            <p>Complete MLOps Pipeline with Training, Deployment, and Monitoring</p>
        </div>

        <div class="diagram-container">
            <h2 class="diagram-title">üìä System Architecture</h2>
            <div class="mermaid">
graph TB
    subgraph "Data Layer"
        A1[("üóÇÔ∏è Training Data<br/>2,100 images")]
        A2[("üóÇÔ∏è Validation Data<br/>528 images")]
    end

    subgraph "Training & Experiment Tracking"
        B1["üéØ PyTorch Training<br/>(3 Models)"]
        B2[("üìä MLflow Tracking<br/>Experiments & Metrics")]
        B3[("üèÜ Model Registry<br/>Production Models")]
    end

    subgraph "Orchestration"
        C1["‚öôÔ∏è Apache Airflow"]
        C2["üìã Training DAG"]
        C3["üöÄ Deployment DAG"]
    end

    subgraph "API & Serving"
        D1["üåê FastAPI Service"]
        D2["üê≥ Docker Container"]
    end

    subgraph "Monitoring"
        E1["üìà Prometheus"]
        E2["üìä Grafana"]
    end

    A1 --> B1
    A2 --> B1
    B1 --> B2
    B2 --> B3
    C1 --> C2
    C1 --> C3
    C2 --> B1
    C3 --> D2
    B3 --> C3
    D2 --> D1
    D1 --> E1
    E1 --> E2

    style A1 fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style A2 fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B1 fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style B2 fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style B3 fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style C1 fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style C2 fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style C3 fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style D1 fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    style D2 fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style E1 fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style E2 fill:#fff9c4,stroke:#f57f17,stroke-width:2px
            </div>
        </div>

        <div class="diagram-container">
            <h2 class="diagram-title">üîÑ Complete MLOps Workflow</h2>
            <div class="mermaid">
flowchart TD
    subgraph "1Ô∏è‚É£ Data & Training"
        S1["üì• Load Dataset"] --> S2["üîÑ Augmentation"]
        S2 --> T1["üéØ Select Model"]
        T1 --> T2["üèãÔ∏è Train & Validate"]
        T2 --> T3{"üõë Early Stop?"}
        T3 -->|No| T2
        T3 -->|Yes| T4["üíæ Save Best Model"]
    end

    subgraph "2Ô∏è‚É£ Experiment Tracking"
        E1["üìä Log Metrics<br/>(Accuracy, F1)"] --> E2["üíæ Save Artifacts"]
        E2 --> E3["üîç Compare Models"]
        E3 --> R1{"üèÜ Best Model?"}
        R1 -->|Yes| R2["üìù Register to<br/>Production"]
        R1 -->|No| R3["‚è≠Ô∏è Skip"]
    end

    subgraph "3Ô∏è‚É£ CI/CD & Deployment"
        D1["üîç Tests & Build"] --> D2["üê≥ Docker Image"]
        D2 --> D3["üé≠ Deploy Staging"]
        D3 --> D4{"‚úÖ Health OK?"}
        D4 -->|No| D5["‚èÆÔ∏è Rollback"]
        D4 -->|Yes| D6["üåü Production"]
    end

    subgraph "4Ô∏è‚É£ Monitoring & Feedback"
        M1["üìä Prometheus<br/>Collect Metrics"] --> M2["üìà Grafana<br/>Dashboards"]
        M2 --> M3{"‚ö†Ô∏è Issue?"}
        M3 -->|Yes| M4["üîÑ Retrain"]
        M3 -->|No| M5["‚úÖ Continue"]
    end

    T4 --> E1
    R2 --> D1
    R3 --> D1
    D6 --> M1
    M4 --> S1
    M5 --> M1

    style S1 fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style S2 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style T1 fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style T2 fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px
    style T3 fill:#ffcc80,stroke:#f57c00,stroke-width:2px
    style T4 fill:#ffa726,stroke:#ff9800,stroke-width:2px
    style E1 fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    style E2 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    style E3 fill:#ce93d8,stroke:#8e24aa,stroke-width:2px
    style R1 fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style R2 fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px
    style R3 fill:#9e9e9e,stroke:#424242,stroke-width:2px
    style D1 fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    style D2 fill:#b2dfdb,stroke:#00796b,stroke-width:2px
    style D3 fill:#80cbc4,stroke:#00897b,stroke-width:2px
    style D4 fill:#4db6ac,stroke:#009688,stroke-width:2px
    style D5 fill:#f44336,stroke:#c62828,stroke-width:2px,color:#fff
    style D6 fill:#66bb6a,stroke:#388e3c,stroke-width:3px,color:#fff
    style M1 fill:#ffccbc,stroke:#d84315,stroke-width:2px
    style M2 fill:#ffab91,stroke:#e64a19,stroke-width:2px
    style M3 fill:#ff8a65,stroke:#f4511e,stroke-width:2px
    style M4 fill:#ff5252,stroke:#d32f2f,stroke-width:2px,color:#fff
    style M5 fill:#81c784,stroke:#388e3c,stroke-width:2px,color:#fff
            </div>
        </div>

        <div class="footer">
            <p><strong>Technology Stack:</strong> PyTorch 2.1+ | MLflow 2.9+ | FastAPI | Docker | Airflow | Prometheus & Grafana</p>
            <p><strong>Model Performance:</strong> EfficientNet-B0 Optimized - 98.67% Accuracy | 6 Disease Classes</p>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        async function exportAsImage(format) {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚è≥ ƒêang xu·∫•t...';
            button.disabled = true;

            try {
                // Wait for mermaid to fully render
                await new Promise(resolve => setTimeout(resolve, 1000));

                const element = document.getElementById('printPage');

                const canvas = await html2canvas(element, {
                    scale: 2, // High quality
                    backgroundColor: '#ffffff',
                    logging: false,
                    windowWidth: 1200,
                    windowHeight: element.scrollHeight
                });

                const link = document.createElement('a');
                link.download = `rice-disease-mlops-architecture.${format}`;

                if (format === 'jpg') {
                    link.href = canvas.toDataURL('image/jpeg', 0.95);
                } else {
                    link.href = canvas.toDataURL('image/png');
                }

                link.click();

                button.textContent = '‚úÖ Xu·∫•t th√†nh c√¥ng!';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Export error:', error);
                alert('‚ùå L·ªói khi xu·∫•t h√¨nh ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c d√πng ch·ª©c nƒÉng Print.');
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        function copyToClipboard() {
            const mermaidCodes = Array.from(document.querySelectorAll('.mermaid'))
                .map(el => el.textContent.trim())
                .join('\n\n---\n\n');

            navigator.clipboard.writeText(mermaidCodes).then(() => {
                alert('‚úÖ Mermaid code ƒë√£ ƒë∆∞·ª£c copy! Paste v√†o mermaid.live ƒë·ªÉ edit.');
            }).catch(() => {
                alert('‚ùå Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng t·ª´ source code.');
            });
        }

        // Print styling
        window.onbeforeprint = function() {
            document.body.style.background = 'white';
        };
    </script>
</body>
</html>
